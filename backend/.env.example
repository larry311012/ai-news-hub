# ============================================================================
# AI Post Generator - Backend Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
# Development - SQLite (default)
DATABASE_URL=sqlite:///./ai_news.db

# Development - PostgreSQL (recommended for local development)
# DATABASE_URL=postgresql://localhost:5432/ai_news_local

# Production - PostgreSQL with credentials
# DATABASE_URL=postgresql://user:password@localhost:5432/ai_news_production

# Production - PostgreSQL with SSL (recommended)
# DATABASE_URL=postgresql://user:password@host:5432/dbname?sslmode=require

# Cloud PostgreSQL Examples:
# AWS RDS: postgresql://user:password@instance.region.rds.amazonaws.com:5432/dbname
# Heroku: postgres://user:password@host:5432/dbname
# Supabase: postgresql://postgres:password@db.project.supabase.co:5432/postgres

# ----------------------------------------------------------------------------
# Security - REQUIRED
# ----------------------------------------------------------------------------
# Generate a new key using:
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# IMPORTANT: Keep this key consistent across restarts to maintain encrypted data access
ENCRYPTION_KEY=your-encryption-key-here

# ----------------------------------------------------------------------------
# CORS Configuration - SECURITY CRITICAL
# ----------------------------------------------------------------------------
# Comma-separated list of allowed origins for CORS requests
# IMPORTANT: Never use wildcard "*" in production!
#
# Development (default if not set):
# ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000,http://127.0.0.1:8000
#
# Production (example):
# ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com
#
# Leave blank to use development defaults
ALLOWED_ORIGINS=

# ----------------------------------------------------------------------------
# Session Configuration
# ----------------------------------------------------------------------------
SESSION_EXPIRE_DAYS=30

# ----------------------------------------------------------------------------
# Application Configuration
# ----------------------------------------------------------------------------
APP_URL=http://localhost:3000
ENVIRONMENT=development  # development|staging|production

# ----------------------------------------------------------------------------
# Error Tracking & Monitoring - Sentry (Optional)
# ----------------------------------------------------------------------------
# Sentry Error Tracking - Monitors errors, performance, and user experience
#
# Setup Instructions:
# 1. Sign up for free account at https://sentry.io/signup/
#    - Free tier: 50,000 events/month, 1 project, 1 user
#    - Perfect for development and small production apps
#
# 2. Create a new project:
#    - Click "Projects" in sidebar
#    - Click "Create Project"
#    - Select "FastAPI" as the platform
#    - Name your project (e.g., "ai-news-aggregator")
#
# 3. Copy your DSN (Data Source Name):
#    - After creating project, you'll see the DSN
#    - Format: https://[key]@[organization].ingest.sentry.io/[project_id]
#    - Paste it below
#
# 4. View your errors:
#    - Dashboard: https://sentry.io/organizations/[org]/issues/
#    - Performance: https://sentry.io/organizations/[org]/performance/
#
# Benefits:
# - Automatic error capture with stack traces
# - Performance monitoring (slow queries, API calls)
# - User context (which users are affected)
# - Email/Slack alerts for critical errors
# - Source code integration (links to exact line of code)
# - Release tracking (track errors by deployment)
#
# Example DSN (replace with your actual DSN):
# SENTRY_DSN=https://abc123def456@o123456.ingest.sentry.io/7890123
#
# Leave blank to disable Sentry (local development)
SENTRY_DSN=

# Environment name shown in Sentry dashboard
# Helps distinguish between dev/staging/production errors
# ENVIRONMENT is already defined above, but can be overridden here if needed
# ENVIRONMENT=development

# ----------------------------------------------------------------------------
# Phase 3: OAuth Configuration (Optional - for Social Login)
# ----------------------------------------------------------------------------
# Google OAuth - Get credentials from:
# https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your-google-client-id-here
GOOGLE_CLIENT_SECRET=your-google-client-secret-here
GOOGLE_REDIRECT_URI=http://localhost:8000/api/auth/oauth/google/callback

# GitHub OAuth - Get credentials from:
# https://github.com/settings/developers
GITHUB_CLIENT_ID=your-github-client-id-here
GITHUB_CLIENT_SECRET=your-github-client-secret-here
GITHUB_REDIRECT_URI=http://localhost:8000/api/auth/oauth/github/callback

# OAuth Base URL (for frontend redirects)
OAUTH_REDIRECT_BASE_URL=http://localhost:8000

# ----------------------------------------------------------------------------
# Social Media Platform OAuth (Required for Publishing)
# ----------------------------------------------------------------------------

# LinkedIn OAuth 2.0 - Get credentials from:
# https://www.linkedin.com/developers/apps
# Required scopes: openid, profile, email, w_member_social
LINKEDIN_CLIENT_ID=your-linkedin-client-id-here
LINKEDIN_CLIENT_SECRET=your-linkedin-client-secret-here
LINKEDIN_REDIRECT_URI=http://localhost:8000/api/social-media/linkedin/callback

# ----------------------------------------------------------------------------
# Twitter/X OAuth - PRODUCTION-READY IMPLEMENTATION
# ----------------------------------------------------------------------------
# Complete Twitter OAuth 1.0a implementation with:
# ✓ CSRF protection via state parameter
# ✓ Database-backed token storage (production-ready)
# ✓ Comprehensive error handling
# ✓ Audit logging and rate limit tracking
# ✓ Webhook support for token revocation
#
# Get credentials from: https://developer.twitter.com/en/portal/dashboard
# Setup Guide: See TWITTER_OAUTH_COMPLETE_GUIDE.md
#
# RECOMMENDED: Use this for all Twitter integrations
# No user-created apps needed! Just set these and go.
# ----------------------------------------------------------------------------

# Twitter OAuth 1.0a (REQUIRED)
TWITTER_API_KEY=your-api-key-here              # Consumer Key from Twitter Dev Portal
TWITTER_API_SECRET=your-api-secret-here        # Consumer Secret from Twitter Dev Portal
TWITTER_CALLBACK_URL=http://localhost:8000/api/twitter/oauth/callback

# Twitter Webhook (OPTIONAL - for production token revocation handling)
# Set this if you want to receive webhook events when users revoke access
# Documentation: https://developer.twitter.com/en/docs/twitter-api/enterprise/account-activity-api
TWITTER_WEBHOOK_SECRET=your-webhook-secret-here

# Optional: Bearer token for read-only API v2 operations
TWITTER_BEARER_TOKEN=your-bearer-token-here

# ----------------------------------------------------------------------------
# Threads OAuth 2.0
# ----------------------------------------------------------------------------
# Threads OAuth 2.0 (Instagram Graph API) - Get credentials from:
# https://developers.facebook.com/apps/
# Required scopes: threads_basic, threads_content_publish
THREADS_CLIENT_ID=your-threads-client-id-here
THREADS_CLIENT_SECRET=your-threads-client-secret-here
THREADS_REDIRECT_URI=http://localhost:8000/api/social-media/threads/callback

# ----------------------------------------------------------------------------
# Instagram OAuth 2.0 & Image Generation - NEW
# ----------------------------------------------------------------------------
# Instagram Business Account Integration (via Facebook Graph API)
# Get credentials from: https://developers.facebook.com/apps/
# Required scopes: instagram_basic, instagram_content_publish, pages_read_engagement
#
# IMPORTANT:
# - Requires Instagram Business Account (not personal)
# - Must link Instagram to Facebook Page
# - Business account setup: https://help.instagram.com/502981923235522
# ----------------------------------------------------------------------------

# Instagram OAuth 2.0
INSTAGRAM_APP_ID=your-instagram-app-id-here
INSTAGRAM_APP_SECRET=your-instagram-app-secret-here
INSTAGRAM_CALLBACK_URL=http://localhost:8000/api/social-media/instagram/oauth/callback

# ----------------------------------------------------------------------------
# AI Image Generation (for Instagram)
# ----------------------------------------------------------------------------
# OpenAI DALL-E 3 (Recommended)
# Get API key from: https://platform.openai.com/api-keys
# Pricing: $0.040 per image (1024x1024, standard quality)
# Pricing: $0.080 per image (1024x1024, HD quality)
IMAGE_GENERATION_PROVIDER=openai  # openai, stable-diffusion
OPENAI_API_KEY=sk-...  # Can reuse existing OpenAI key or create separate one

# DALL-E Configuration
DALLE_MODEL=dall-e-3  # dall-e-2, dall-e-3
DALLE_IMAGE_SIZE=1024x1024  # 1024x1024, 1792x1024, 1024x1792
DALLE_IMAGE_QUALITY=standard  # standard, hd (hd is 2x cost)

# Alternative: Stable Diffusion API (Lower cost, self-hosted option)
# STABLE_DIFFUSION_API_URL=http://localhost:7860
# STABLE_DIFFUSION_API_KEY=your-api-key

# ----------------------------------------------------------------------------
# Image Storage Configuration
# ----------------------------------------------------------------------------
# Local storage (for development)
IMAGE_STORAGE_BACKEND=local  # local, s3, cloudinary
# IMAGE_STORAGE_PATH=/path/to/storage/instagram_images  # Defaults to web/backend/storage/instagram_images

# AWS S3 Storage (for production)
# AWS_S3_BUCKET=ai-news-aggregator-instagram
# AWS_S3_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-access-key-id
# AWS_SECRET_ACCESS_KEY=your-secret-access-key
# AWS_CLOUDFRONT_DOMAIN=d1234567890.cloudfront.net  # Optional CDN

# Image Generation Limits & Settings
MAX_IMAGE_GENERATIONS_PER_DAY=50  # Per user limit
IMAGE_CACHE_TTL_DAYS=30  # How long to keep cached images
MAX_IMAGE_FILE_SIZE_MB=8  # Maximum image file size (Instagram limit)
IMAGE_COMPRESSION_QUALITY=85  # JPEG quality (1-100)

# ----------------------------------------------------------------------------
# Phase 3: Email Configuration
# ----------------------------------------------------------------------------
# Email Mode: development (console logs) | smtp (SMTP server) | sendgrid (SendGrid API)
EMAIL_MODE=development

# SMTP Configuration (if EMAIL_MODE=smtp)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM_EMAIL=noreply@example.com
SMTP_FROM_NAME=AI Post Generator

# SendGrid Configuration (if EMAIL_MODE=sendgrid)
# Get API key from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=your-sendgrid-api-key-here


# ----------------------------------------------------------------------------
# Anonymous Mode (Single-User Deployment)
# ----------------------------------------------------------------------------
# Enable anonymous mode to run the backend without authentication
# WARNING: All users share the same account (user_id=1)!
#
# Use Cases:
# - Personal single-user deployments
# - Docker containers for personal use
# - Local development without auth complexity
# - Private network deployments (Tailscale, VPN)
#
# Security Considerations:
# - Only deploy behind firewall or reverse proxy with auth
# - Do NOT use on public internet without additional security
# - All data belongs to user_id=1
# - OAuth connections are shared across all requests
#
# Setup:
# 1. Run: python scripts/create_anonymous_user.py
# 2. Set ANONYMOUS_MODE=true
# 3. Restart backend
# 4. No login required - direct API access
#
# To disable: Set ANONYMOUS_MODE=false (or remove line)
ANONYMOUS_MODE=false
# ----------------------------------------------------------------------------
# Phase 4: Security Features
# ----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true
SECURITY_MONITORING_ENABLED=true

# ----------------------------------------------------------------------------
# Redis Configuration - PERFORMANCE OPTIMIZATION
# ----------------------------------------------------------------------------
# Redis caching layer for dramatically improved performance
# Development: Install with `brew install redis` or `apt-get install redis`
# Production: Use managed Redis (AWS ElastiCache, Redis Cloud, etc.)

# Redis Connection Settings
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_SSL=false

# Redis Connection Pool Settings
REDIS_MAX_CONNECTIONS=50  # Max connections in pool
REDIS_SOCKET_TIMEOUT=5  # Socket timeout in seconds
REDIS_SOCKET_CONNECT_TIMEOUT=5  # Connect timeout in seconds

# Cache Feature Flags
CACHE_ENABLED=true  # Enable/disable caching globally
CACHE_DEBUG=false  # Enable verbose cache logging (development only)

# Cache TTL Override (optional - defaults are in redis_config.py)
# CACHE_TTL_SHORT=60  # 1 minute
# CACHE_TTL_MEDIUM=300  # 5 minutes
# CACHE_TTL_LONG=3600  # 1 hour
# CACHE_TTL_VERY_LONG=86400  # 24 hours

# ----------------------------------------------------------------------------
# API Keys (Managed through Settings API)
# ----------------------------------------------------------------------------
# These are stored encrypted in the database via /api/settings endpoints
# Do NOT add them here - use the Settings API instead:
#
# POST /api/settings/api-keys
# {
#   "provider": "openai",
#   "api_key": "sk-...",
#   "alias": "My OpenAI Key"
# }

# ----------------------------------------------------------------------------
# Optional Production Settings
# ----------------------------------------------------------------------------

# Logging
# LOG_LEVEL=INFO  # DEBUG|INFO|WARNING|ERROR

# ----------------------------------------------------------------------------
# Development Notes
# ----------------------------------------------------------------------------
# 1. Copy this file to .env: cp .env.example .env
# 2. Generate ENCRYPTION_KEY (required):
#    python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# 3. Configure Database (recommended for development):
#    - Install PostgreSQL: brew install postgresql@15
#    - Create database: createdb ai_news_local
#    - Set DATABASE_URL=postgresql://localhost:5432/ai_news_local
# 4. Configure Redis (recommended for performance):
#    - Install Redis: brew install redis (macOS) or apt-get install redis (Linux)
#    - Start Redis: redis-server
#    - Verify: redis-cli ping (should return PONG)
# 5. Configure Sentry (optional - for error tracking):
#    - Sign up at https://sentry.io/signup/
#    - Create FastAPI project
#    - Copy DSN to SENTRY_DSN variable above
#    - Test with: curl http://localhost:8000/api/sentry-test
# 6. Configure Twitter OAuth (recommended):
#    - See TWITTER_OAUTH_COMPLETE_GUIDE.md
#    - Set TWITTER_API_KEY and TWITTER_API_SECRET
# 7. Configure Instagram (for image posting):
#    - See INSTAGRAM_BACKEND_ARCHITECTURE.md
#    - Set up Facebook Developer account
#    - Create Instagram Business account
#    - Set INSTAGRAM_APP_ID and INSTAGRAM_APP_SECRET
#    - Set OPENAI_API_KEY for DALL-E image generation
# 8. Run database migrations:
#    - Twitter: python migrate_twitter_oauth_complete.py migrate
#    - Instagram: sqlite3 ai_news.db < migrations/add_instagram_support.sql
# 9. Configure other OAuth providers if needed:
#    - LinkedIn: See https://www.linkedin.com/developers/apps
#    - Threads: See https://developers.facebook.com/apps/
# 10. Never commit .env to version control
# 11. See SETUP_GUIDE.md for detailed instructions

# ----------------------------------------------------------------------------
# Quick Start (Minimum Required)
# ----------------------------------------------------------------------------
# 1. ENCRYPTION_KEY - Generate and set this first
# 2. DATABASE_URL - Use PostgreSQL for production-like environment
# 3. REDIS_HOST - Install and start Redis (brew install redis && redis-server)
# 4. SENTRY_DSN - Optional but recommended (free tier available)
# 5. TWITTER_API_KEY - Get from Twitter Developer Portal
# 6. TWITTER_API_SECRET - Get from Twitter Developer Portal
# 7. OPENAI_API_KEY - Get from OpenAI Platform (for AI content + images)
# 8. Run migrations
# 9. Create storage directory: mkdir -p web/backend/storage/instagram_images
#
# That's it! Users can now connect Twitter/Instagram and generate AI images.

# ----------------------------------------------------------------------------
# Database Migration Guide
# ----------------------------------------------------------------------------
# When migrating from SQLite to PostgreSQL:
# 1. Install psycopg2: pip install psycopg2-binary
# 2. Create PostgreSQL database: createdb ai_news_local
# 3. Run migration script: python scripts/migrate_sqlite_to_postgres.py
# 4. Update DATABASE_URL in .env
# 5. Verify migration: psql ai_news_local -c "SELECT COUNT(*) FROM users;"
# 6. Run indexes script: psql ai_news_local < scripts/add_indexes.sql
# 7. Restart backend server
